angular.module("ngTableResize",[]),angular.module("ngTableResize").directive("resizable",["resizeStorage","$injector",function(t,e){function i(){this.columns=[],this.isFirstDrag=!0,this.resizer=s(this);var e={};this.addColumn=function(t){Number.isInteger(t.$index)?this.columns.splice(t.$index,0,t):this.columns.push(t)},this.loadSavedColumns=function(){e=t.loadTableSizes(this.id,this.mode,this.profile)},this.injectResizer=function(){this.resizer&&this.resizer.tearDown();var t=s(this);null!==t&&(this.resizer=t),this.loadSavedColumns()},this.getStoredWidth=function(t){return e[t.resize]},this.initialiseColumns=function(){this.columns&&0!==this.columns.length&&(this.canRestoreColumns()?this.initSavedColumns():this.initDefaultColumns())},this.canRestoreColumns=function(){var t=this,i=!0;this.resizer.strictSaving===!0&&(i=Object.keys(e).length===t.columns.length);var n=this.columns.every(function(e){return t.getStoredWidth(e)||t.resizer.newColumnWidth(e)});return i&&n},this.render=function(){this.columns&&0!==this.columns.length&&(this.resetAll(),this.initialiseAll(),this.resizer.setup(),this.initialiseColumns())},this.initSavedColumns=function(){var t=this;this.columns.forEach(function(e){e.setWidth(t.getStoredWidth(e)||t.resizer.newColumnWidth(e))}),this.resizer.onTableReady(),this.virgin=!1},this.initDefaultColumns=function(){var t=this;this.columns.forEach(function(e){e.setWidth(t.resizer.defaultWidth(e))}),this.virgin=!0},this.getColumns=function(){return this.columns.map(function(t){return t.element})},this.removeColumn=function(t){var e=this.columns.indexOf(t);e>-1&&this.columns.splice(e,1),this.resetAll(),this.initialiseAll(),this.initialiseColumns()},this.deleteHandles=function(){this.columns.forEach(function(t){t.deleteHandle()})},this.resetAll=function(){this.isFirstDrag=!0,this.virgin=!0,this.deleteHandles()},this.initialiseAll=function(){this.columns.forEach(function(t){t.initialise()})},this.saveColumnSizes=function(){var i=this;e={},this.columns.forEach(function(t){e[t.resize]=i.resizer.saveAttr(t)}),t.saveTableSizes(this.id,this.mode,this.profile,e)},this.nextColumn=function(t){var e=this.columns.indexOf(t);return e===-1||e>=this.columns.length?void 0:this.columns[e+1]}}function n(t,e){return t.addClass("resize"),r}function r(t,e,i,n){n.table=$(e),n.id=i.id,n.loadSavedColumns(),n.container=i.container?$(i.container):e.parent(),o(t,e,n)}function o(t,e,i){function n(){var t=[];return $(e).find("th").each(function(e,i){t.push(angular.element(i).scope())}),t}t.$watch(function(){return i.mode},function(t){t&&(i.injectResizer(),i.render())}),t.$watch(function(){return i.profile},function(t){t&&(i.loadSavedColumns(),i.initialiseColumns())}),t.$watch(function(){return $(e).find("th").length},function(){i.columns=n(),i.render()})}function s(t){try{var i=t.mode?t.mode:"BasicResizer",n=e.get(i);if(!n)return;return new n(t)}catch(r){return console.error("The resizer "+t.mode+" was not found"),null}}return{restrict:"A",priority:0,compile:n,controller:i,controllerAs:"rzctrl",bindToController:!0,scope:{hello:"@?",mode:"=?",profile:"=?",columnsCollection:"=?columns",bind:"=?"}}}]),angular.module("ngTableResize").directive("resize",[function(){function t(){return{pre:e,post:i}}function e(t,e,i,r){t.resize=t.$eval(i.resize),t.element=e,t.deleteHandle=function(){t.handle&&t.handle.remove()},t.addHandle=function(){n(t,r,e)},t.isValid=function(){return!(!t.displacers||!t.displacers.length)&&t.displacers.every(function(t){return t.isValid()})},t.initialise=function(){r.resizer.handles(t)&&(t.displacers=this.getDisplacers(),t.isValid()&&(console.log("Initialised!",t),n(t,r,e)))},t.getDisplacers=function(){var e=r.resizer.displacers(t.element,t);return Array.isArray(e)?e:[e]},t.setWidth=function(t){e.css({width:t})},t.next=function(){return r.nextColumn(t)},t.getWidth=function(){return t.element.outerWidth()},t.$on("$destroy",function(){r.removeColumn(t)})}function i(t,e,i,n){}function n(t,e,i){t.handle=$("<div>",{"class":"handle"}),i.prepend(t.handle),r(t,e)}function r(t,e){$(t.handle).mousedown(function(i){e.isFirstDrag&&(e.resizer.onFirstDrag(),e.resizer.onTableReady(),e.isFirstDrag=!1,e.virgin=!1),i.preventDefault(),$(t.handle).addClass("active"),$("body").addClass("table-resize");var n=i.clientX;t.displacers.forEach(function(t){t.freeze()}),$(window).mousemove(o(t,e,n)),$(window).one("mouseup",s(t,e,t.handle))})}function o(t,e,i){return function(e){var n=e.clientX,r=n-i;t.displacers.forEach(function(t){t.prepare(r)});var o=t.displacers.every(function(t){return t.allowed()});o&&t.displacers.forEach(function(t){t.commit()})}}function s(t,e,i){return function(){$(i).removeClass("active"),$(window).unbind("mousemove"),$("body").removeClass("table-resize"),e.resizer.onEndDrag(),e.saveColumnSizes()}}return{restrict:"A",compile:t,require:"^^resizable",scope:!1}}]),angular.module("ngTableResize").service("resizeStorage",["$window",function(t){function e(t,e,n){var r=[];return t?(r.push(i),r.push(t),r.push(e),n&&r.push(n),r.join(".")):void console.error("Table has no id",t)}var i="ngColumnResize";this.loadTableSizes=function(i,n,r){var o=e(i,n,r),s=t.localStorage.getItem(o);return JSON.parse(s)||{}},this.saveTableSizes=function(i,n,r,o){var s=e(i,n,r);if(s){var c=JSON.stringify(o);t.localStorage.setItem(s,c)}}}]),angular.module("ngTableResize").factory("ResizerModel",["Displacer",function(t){function e(t){this.strictSaving=!0,this.minWidth=50,this.ctrl=t}return e.prototype.setup=function(){$(this.ctrl.container).css({overflowX:"hidden"})},e.prototype.tearDown=function(){},e.prototype.defaultWidth=function(t){return"auto"},e.prototype.newColumnWidth=function(t){return!1},e.prototype.onTableReady=function(){$(this.ctrl.table).outerWidth("100%")},e.prototype.handles=function(){return!0},e.prototype.onFirstDrag=function(){this.ctrl.columns.forEach(function(t){t.setWidth(t.getWidth())})},e.prototype.displacers=function(e,i){return new t({column:e})},e.prototype.onEndDrag=function(){},e.prototype.saveAttr=function(t){return t.getWidth()},e}]),angular.module("ngTableResize").factory("Displacer",[function(){function t(e){this.column=e.column,this.scope=angular.element(this.column).scope(),this.orgWidth=null,this.resizer=e.resizer,this.calculate=e.calculate||t.DISPLACE_ADD,this.restrictFunc=e.restrict||t.RESTRICT}return t.RESTRICT=function(t){return t<50},t.DISPLACE_ADD=function(t,e){return t+e},t.DISPLACE_SUB=function(t,e){return t-e},t.prototype.restrict=function(t){return this.resizer?this.restrictFunc.call(this.resizer,t):this.restrictFunc(t)},t.prototype.isValid=function(){return!!this.column&&!!this.scope},t.prototype.freeze=function(){this.orgWidth=this.scope.getWidth()},t.prototype.prepare=function(t){this.newWidth=this.calculate(this.orgWidth,t)},t.prototype.allowed=function(){return!this.restrict(this.newWidth)},t.prototype.commit=function(){this.scope.setWidth(this.newWidth)},t.prototype.displace=function(t){var e=this.calculate(this.orgWidth,t);this.restrict(e)||this.scope.setWidth(e)},t}]),angular.module("ngTableResize").factory("BasicResizer",["ResizerModel","Displacer",function(t,e){function i(e,i,n){t.call(this,e,i,n)}return i.prototype=Object.create(t.prototype),i.prototype.setup=function(t,e){this.ctrl.container.css({overflowX:"hidden"}),this.ctrl.columns[0].setWidth("auto")},i.prototype.handles=function(t){return t.$last!==!0},i.prototype.onFirstDrag=function(){this.ctrl.columns.forEach(function(t){t.setWidth(t.getWidth())})},i.prototype.displacers=function(t,i){return[new e({column:t,calculate:e.DISPLACE_ADD}),new e({column:$(t).next(),calculate:e.DISPLACE_SUB})]},i.prototype.onEndDrag=function(){var t=$(this.ctrl.table).outerWidth(),e=0;this.ctrl.columns.forEach(function(i){var n=i.getWidth(),r=n/t*100+"%";e+=n/t*100,i.setWidth(r)})},i.prototype.saveAttr=function(t){return $(t.element)[0].style.width},i}]),angular.module("ngTableResize").factory("FixedResizer",["ResizerModel","Displacer",function(t,e){function i(e,i,n){t.call(this,e,i,n),this.fixedColumn=$(this.ctrl.table).find("th").first(),this.bound=!1}return i.prototype=Object.create(t.prototype),i.prototype.setup=function(){$(this.ctrl.container).css({overflowX:"hidden"}),this.ctrl.columns[0].setWidth("auto")},i.prototype.handles=function(){return this.ctrl.columns.slice(0,-1)},i.prototype.onFirstDrag=function(){this.ctrl.columns.slice(1).forEach(function(t){t.setWidth(t.getWidth())})},i.prototype.restrict=function(t){return this.bound?!(t<this.bound)||($(this.fixedColumn).width("auto"),this.bound=!1,!1):t<this.minWidth||($(this.fixedColumn).width()<=this.minWidth?(this.bound=t,$(this.fixedColumn).width(this.minWidth),!0):void 0)},i.prototype.displacers=function(t,i){return new e({column:$(t).next(),calculate:e.DISPLACE_SUB,resizer:this,restrict:this.restrict})},i.prototype.saveAttr=function(t){return t===this.ctrl.columns[0]?"auto":t.getWidth()},i}]),angular.module("ngTableResize").factory("OverflowResizer",["ResizerModel",function(t){function e(e,i,n){t.call(this,e,i,n),this.strictSaving=!1}return e.prototype=Object.create(t.prototype),e.prototype.newColumnWidth=function(t){return 150},e.prototype.setup=function(){$(this.ctrl.container).css({overflow:"auto"})},e.prototype.tearDown=function(){$(this.ctrl.table).width("")},e.prototype.onTableReady=function(){$(this.ctrl.table).width(1)},e}]);