angular.module("ngTableResize",[]),angular.module("ngTableResize").directive("resizable",["resizeStorage","$injector",function(t,e){function n(){this.columns=[],this.isFirstDrag=!0,this.resizer=s(this);var e={};this.addColumn=function(t){Number.isInteger(t.$index)?this.columns.splice(t.$index,0,t):this.columns.push(t)},this.loadSavedColumns=function(){e=t.loadTableSizes(this.id,this.mode,this.profile)},this.injectResizer=function(){this.resizer&&this.resizer.tearDown();var t=s(this);null!==t&&(this.resizer=t),this.loadSavedColumns()},this.getStoredWidth=function(t){return e[t.resize]},this.initialiseColumns=function(){this.columns&&0!==this.columns.length&&(this.canRestoreColumns()?this.initSavedColumns():this.initDefaultColumns())},this.canRestoreColumns=function(){var t=this,n=!0;this.resizer.strictSaving===!0&&(n=Object.keys(e).length===t.columns.length);var i=this.columns.every(function(e){return t.getStoredWidth(e)||t.resizer.newColumnWidth(e)});return n&&i},this.render=function(){this.columns&&0!==this.columns.length&&(this.resetAll(),this.initialiseAll(),this.resizer.setup(),this.initialiseColumns())},this.initSavedColumns=function(){var t=this;this.columns.forEach(function(e){e.setWidth(t.getStoredWidth(e)||t.resizer.newColumnWidth(e))}),this.resizer.onTableReady(),this.virgin=!1},this.initDefaultColumns=function(){var t=this;this.columns.forEach(function(e){e.setWidth(t.resizer.defaultWidth(e))}),this.virgin=!0},this.getColumns=function(){return this.columns.map(function(t){return t.element})},this.removeColumn=function(t){var e=this.columns.indexOf(t);e>-1&&this.columns.splice(e,1),this.resetAll(),this.initialiseAll(),this.initialiseColumns()},this.deleteHandles=function(){this.columns.forEach(function(t){t.deleteHandle()})},this.resetAll=function(){this.isFirstDrag=!0,this.virgin=!0,this.deleteHandles()},this.initialiseAll=function(){this.columns.forEach(function(t){t.initialise()})},this.saveColumnSizes=function(){var n=this;e={},this.columns.forEach(function(t){e[t.resize]=n.resizer.saveAttr(t)}),t.saveTableSizes(this.id,this.mode,this.profile,e)},this.nextColumn=function(t){var e=this.columns.indexOf(t);return e===-1||e>=this.columns.length?void 0:this.columns[e+1]}}function i(t,e){return t.addClass("resize"),r}function r(t,e,n,i){i.table=$(e),i.id=n.id,i.loadSavedColumns(),i.container=n.container?$(n.container):e.parent(),o(t,e,i)}function o(t,e,n){function i(){var t=[];return $(e).find("th").each(function(e,n){t.push(angular.element(n).scope())}),t}t.$watch(function(){return n.mode},function(t){t&&(n.injectResizer(),n.render())}),t.$watch(function(){return n.profile},function(t){t&&(n.loadSavedColumns(),n.initialiseColumns())}),t.$watch(function(){return $(e).find("th").length},function(){n.columns=i(),n.render()})}function s(t){try{var n=t.mode?t.mode:"BasicResizer",i=e.get(n);if(!i)return;return new i(t)}catch(r){return console.error("The resizer "+t.mode+" was not found"),null}}return{restrict:"A",priority:0,compile:i,controller:n,controllerAs:"rzctrl",bindToController:!0,scope:{hello:"@?",mode:"=?",profile:"=?",columnsCollection:"=?columns",bind:"=?"}}}]),angular.module("ngTableResize").directive("resize",[function(){function t(){return{pre:e,post:n}}function e(t,e,n,r){t.resize=t.$eval(n.resize),t.element=e,t.deleteHandle=function(){t.handle&&t.handle.remove()},t.addHandle=function(){i(t,r,e)},t.isValid=function(){return!(!t.displacers||!t.displacers.length)&&t.displacers.every(function(t){return t.isValid()})},t.initialise=function(){r.resizer.handles(t)&&(t.displacers=this.getDisplacers(),t.isValid()&&(console.log("Initialised!",t),i(t,r,e)))},t.getDisplacers=function(){var e=r.resizer.displacers(t.element,t);return Array.isArray(e)?e:[e]},t.setWidth=function(t){e.css({width:t})},t.next=function(){return r.nextColumn(t)},t.getWidth=function(){return t.element.outerWidth()},t.$on("$destroy",function(){r.removeColumn(t)})}function n(t,e,n,i){}function i(t,e,n){t.handle=$("<div>",{"class":"handle"}),n.prepend(t.handle),r(t,e)}function r(t,e){$(t.handle).mousedown(function(n){e.isFirstDrag&&(e.resizer.onFirstDrag(),e.resizer.onTableReady(),e.isFirstDrag=!1,e.virgin=!1),n.preventDefault(),$(t.handle).addClass("active"),$("body").addClass("table-resize");var i=n.clientX;t.displacers.forEach(function(t){t.freeze()}),$(window).mousemove(o(t,e,i)),$(window).one("mouseup",s(t,e,t.handle))})}function o(t,e,n){return function(e){var i=e.clientX,r=i-n;t.displacers.forEach(function(t){t.prepare(r)});var o=t.displacers.every(function(t){return t.allowed()});o&&t.displacers.forEach(function(t){t.commit()})}}function s(t,e,n){return function(){$(n).removeClass("active"),$(window).unbind("mousemove"),$("body").removeClass("table-resize"),e.resizer.onEndDrag(),e.saveColumnSizes()}}return{restrict:"A",compile:t,require:"^^resizable",scope:!1}}]),angular.module("ngTableResize").service("resizeStorage",["$window",function(t){function e(t,e,i){var r=[];return t?(r.push(n),r.push(t),r.push(e),i&&r.push(i),r.join(".")):void console.error("Table has no id",t)}var n="ngColumnResize";this.loadTableSizes=function(n,i,r){var o=e(n,i,r),s=t.localStorage.getItem(o);return JSON.parse(s)||{}},this.saveTableSizes=function(n,i,r,o){var s=e(n,i,r);if(s){var c=JSON.stringify(o);t.localStorage.setItem(s,c)}}}]),angular.module("ngTableResize").factory("ResizerModel",["Displacer",function(t){function e(t){this.strictSaving=!0,this.minWidth=50,this.ctrl=t}return e.prototype.setup=function(){$(this.ctrl.container).css({overflowX:"hidden"})},e.prototype.tearDown=function(){},e.prototype.defaultWidth=function(t){return"auto"},e.prototype.newColumnWidth=function(t){return!1},e.prototype.onTableReady=function(){$(this.ctrl.table).outerWidth("100%")},e.prototype.handles=function(){return!0},e.prototype.ctrlColumns=function(){return!0},e.prototype.onFirstDrag=function(){this.ctrl.columns.forEach(function(t){t.setWidth(t.getWidth())})},e.prototype.handleMiddleware=function(t,e){return t},e.prototype.displacers=function(e,n){return new t({column:e})},e.prototype.restrict=function(t){return t<this.minWidth},e.prototype.calculate=function(t,e){return t+e},e.prototype.onEndDrag=function(){},e.prototype.saveAttr=function(t){return t.getWidth()},e}]),angular.module("ngTableResize").factory("Displacer",[function(){function t(e){this.column=e.column,this.scope=angular.element(this.column).scope(),this.orgWidth=null,this.resizer=e.resizer,this.calculate=e.calculate||t.DISPLACE_ADD,this.restrictFunc=e.restrict||t.RESTRICT}return t.RESTRICT=function(t){return t<50},t.DISPLACE_ADD=function(t,e){return t+e},t.DISPLACE_SUB=function(t,e){return t-e},t.prototype.restrict=function(t){return this.resizer?this.restrictFunc.call(this.resizer,t):this.restrictFunc(t)},t.prototype.isValid=function(){return!!this.column&&!!this.scope},t.prototype.freeze=function(){this.orgWidth=this.scope.getWidth()},t.prototype.prepare=function(t){this.newWidth=this.calculate(this.orgWidth,t)},t.prototype.allowed=function(){return!this.restrict(this.newWidth)},t.prototype.commit=function(){this.scope.setWidth(this.newWidth)},t.prototype.displace=function(t){var e=this.calculate(this.orgWidth,t);this.restrict(e)||this.scope.setWidth(e)},t}]),angular.module("ngTableResize").factory("BasicResizer",["ResizerModel","Displacer",function(t,e){function n(e,n,s){t.call(this,e,n,s),this.ctrlColumns=this.columns,this.intervene={selector:i,calculator:r,restrict:o}}function i(t){return t.next()}function r(t,e){return t-e}function o(t){return t<50}return n.prototype=Object.create(t.prototype),n.prototype.setup=function(t,e){this.ctrl.container.css({overflowX:"hidden"}),this.ctrl.columns[0].setWidth("auto")},n.prototype.handles=function(t){return t.$last!==!0},n.prototype.onFirstDrag=function(){this.ctrl.columns.forEach(function(t){t.setWidth(t.getWidth())})},n.prototype.displacers=function(t,n){return[new e({column:t,calculate:e.DISPLACE_ADD}),new e({column:$(t).next(),calculate:e.DISPLACE_SUB})]},n.prototype.onEndDrag=function(){var t=$(this.ctrl.table).outerWidth(),e=0;this.ctrl.columns.forEach(function(n){var i=n.getWidth(),r=i/t*100+"%";e+=i/t*100,n.setWidth(r)})},n.prototype.saveAttr=function(t){return $(t.element)[0].style.width},n}]),angular.module("ngTableResize").factory("FixedResizer",["ResizerModel","Displacer",function(t,e){function n(e,n,i){t.call(this,e,n,i),this.fixedColumn=$(this.ctrl.table).find("th").first(),this.bound=!1}return n.prototype=Object.create(t.prototype),n.prototype.setup=function(){$(this.ctrl.container).css({overflowX:"hidden"}),this.ctrl.columns[0].setWidth("auto")},n.prototype.handles=function(){return this.ctrl.columns.slice(0,-1)},n.prototype.ctrlColumns=function(){return this.ctrl.columns.slice(1)},n.prototype.onFirstDrag=function(){this.ctrl.columns.slice(1).forEach(function(t){t.setWidth(t.getWidth())})},n.prototype.handleMiddleware=function(t,e){return t.next()},n.prototype.restrict=function(t){return this.bound?!(t<this.bound)||($(this.fixedColumn).width("auto"),this.bound=!1,!1):t<this.minWidth||($(this.fixedColumn).width()<=this.minWidth?(this.bound=t,$(this.fixedColumn).width(this.minWidth),!0):void 0)},n.prototype.displacers=function(t,n){return new e({column:$(t).next(),calculate:e.DISPLACE_SUB,resizer:this,restrict:this.restrict})},n.prototype.calculate=function(t,e){return t-e},n.prototype.saveAttr=function(t){return t===this.ctrl.columns[0]?"auto":t.getWidth()},n}]),angular.module("ngTableResize").factory("OverflowResizer",["ResizerModel",function(t){function e(e,n,i){t.call(this,e,n,i),this.strictSaving=!1}return e.prototype=Object.create(t.prototype),e.prototype.newColumnWidth=function(t){return 150},e.prototype.setup=function(){$(this.ctrl.container).css({overflow:"auto"})},e.prototype.tearDown=function(){$(this.ctrl.table).width("")},e.prototype.onTableReady=function(){$(this.ctrl.table).width(1)},e}]);